enum AnmeldungStatus {
  OFFEN
  BESTAETIGT
  STORNIERT
  ABGELEHNT
}

model Anmeldung {
  id             String          @id @default(uuid(7))
  createdAt      DateTime        @default(now())
  status         AnmeldungStatus @default(OFFEN)
  comment        String?
  accessToken    String?         @db.Uuid
  assignmentCode String?         @db.Uuid

  unterveranstaltungId String
  unterveranstaltung   Unterveranstaltung @relation(fields: [unterveranstaltungId], references: [id], onDelete: Cascade)

  personId String
  person   Person @relation(fields: [personId], references: [id], onDelete: Cascade)

  accountId String?
  account   Account? @relation(fields: [accountId], references: [id], onDelete: Cascade)

  mahlzeitenIds      String[]
  mahlzeiten         Mahlzeit[]
  uebernachtungsTage DateTime[]         @db.Date
  customFieldValues  CustomFieldValue[]

  link AnmeldungLink?
}

model AnmeldungLink {
  id          String    @id @default(uuid(7))
  createdAt   DateTime  @default(now())
  usedAt      DateTime?
  comment     String?
  accessToken String?   @db.Uuid

  unterveranstaltungId String
  unterveranstaltung   Unterveranstaltung @relation(fields: [unterveranstaltungId], references: [id], onDelete: Cascade)

  createdById String
  createdBy   Account @relation(fields: [createdById], references: [id])

  anmeldungId String?    @unique
  anmeldung   Anmeldung? @relation(fields: [anmeldungId], references: [id])
}
